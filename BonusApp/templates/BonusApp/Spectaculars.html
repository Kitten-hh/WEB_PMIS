{% extends 'BaseApp/keen_base/base_form1/base.html' %}

{% load static %}

{%block form_css%}
<style>
    #kt_content{
        padding-top: 0rem;
    }
    #app {
        background-color: #f3f3f3;
    }

    .vue-grid-item {
        background-color: white;
        overflow: hidden;
    }

    .grid-item-header {
        background-color: white;
    }

    .grid-item-header .title-container {
        padding: 4px 5px 0px 10px;
    }

    .grid-item-header i {
        font-size: 14px;
        font-weight: 600;
        vertical-align: middle;
    }

    .vue-grid-item .grid-item-body {
        overflow-y: scroll;
    }

    #task_datatable,
    #simple_datatable2 {
        width: 100% !important;
    }

    #task_datatable thead tr th:nth-child(2) {
        display: none;
    }

    #task_datatable tbody tr td:nth-child(2) {
        display: none;
    }

    #task_datatable thead tr th:nth-child(5) {
        display: none;
    }

    #task_datatable tbody tr td:nth-child(5) {
        display: none;
    }

    #simple_datatable2 thead tr th:nth-child(2) {
        display: none;
    }

    #simple_datatable2 tbody tr td:nth-child(2) {
        display: none;
    }

    #simple_datatable2 thead tr th:nth-child(5) {
        display: none;
    }

    #simple_datatable2 tbody tr td:nth-child(5) {
        display: none;
    }

    th {
        white-space: nowrap;
    }
    /* 搜索框 */
    .scrollable-menu {
        height: auto;
        display: inline-block;
        max-height: 200px;
        overflow-x: hidden;
    }

    #task_search_box {
        /* display: none; */
        width: 20%;
        top: 50%;
        transform: translateY(-50%);
        line-height: 10px;
        margin-right: 45%;
    }
    .content {
        padding: 0px 0;
    }

    .modal-backdrop{
        z-index: 9;
    }

    #TaskType {
        height: 39px;
        /* top: 0.2rem; */
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        line-height: 10px;
    } 

    .datefiler{
        margin-left: 6%;
    }
    
</style>
{% endblock %}

<!-- {% block solenav %}
<div class="container-fluid">
    <a class="nav-link" href="/bonus/Task_Management">
        <svg style="color: white;" width="5em" height="2em" viewBox="0 0 16 16" class="bi bi-house-fill"
            fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd"
                d="M8 3.293l6 6V13.5a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 13.5V9.293l6-6zm5-.793V6l-2-2V2.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5z" />
            <path fill-rule="evenodd"
                d="M7.293 1.5a1 1 0 0 1 1.414 0l6.647 6.646a.5.5 0 0 1-.708.708L8 2.207 1.354 8.854a.5.5 0 1 1-.708-.708L7.293 1.5z" />
        </svg>
    </a>
    <ul class="navbar-nav flex-row ml-auto nav_min_pic">
        <li class="nav-item"><a class="nav-link" id="task_search" href="javascript:void(0)"><i
                    class="fa fa-search"></i></a></li>
        <li class="nav-item"><a class="nav-link" href="#"><i class="fa fa-check-square"></i></a></li>
        <li class="nav-item"><a class="nav-link" href="#"><i class="icon ion-refresh"></i></a></li>
    </ul>
</div>
{% endblock %} -->

{% block content %}
<div id="app">
    <grid-layout :layout.sync="layout" :col-num="12" :row-height="30" :is-draggable="true" :is-resizable="true"
        :is-mirrored="false" :vertical-compact="true" :margin="[10, 10]" :use-css-transforms="true" :responsive="true"
        :cols="{ lg: 12, md: 10, sm: 1, xs: 1, xxs: 1}">
        <!--使用Vue的v-for語句，循環把layout定義的數組對象顯示生成出來-->
        <grid-item v-for="item in layout" :x="item.x" :y="item.y" :w="item.w" :h="item.h" :i="item.i" :key="item.i"
            drag-allow-from=".draggable-header" drag-ignore-from=".no-drag">
            <!--定義grid-item中的內容 開始-->
            <div class="card h-100">
                <div class="card-header text-left grid-item-header p-1">
                    <div class="title-container row justify-content-between m-0">
                        <!--class=draggable-header 表示用戶可以點擊該部分進行拖動改變grid的位置-->
                        <div class="flex flex-fill draggable-header">
                            <h4 class="mb-0">[[item.title]]</h4>
                        </div>
                        <div><i class="fas fa-expand-alt"></i></div>
                    </div>
                </div>
                <div class="card-body no-drag grid-item-body">
                    <!--這裏為grid的內容, 用戶可以自己修改-->

                    <!-- 提交的问题 -->
                    <table id="task_datatable" class="table table-striped- table-hover" v-if="item.i==0">
                        <thead>
                            <tr>
                                <th style="width: 12%;">日期</th>
                                <th>联系人</th>
                                <th>描述</th>
                                <th>状态</th>                                
                                <th></th>
                            </tr>
                        </thead>
                    </table>

                    <!-- 技术文档 -->
                    <table id="simple_datatable2" class="table table-striped- table-hover" v-if="item.i==1">
                        <thead>
                            <tr>
                                <th style="width: 12%;">日期</th>
                                <th>联系人</th>
                                <th>主题</th>
                                <th>状态</th>
                                <th>id</th>                               
                                <th></th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
            <!--定義grid-item中的內容 結束-->
            [[item.i]]
        </grid-item>
    </grid-layout>
</div>
{% endblock %}

<!-- {% block footernav %}

{% endblock %} -->

{% block form_js %} <!-- 调用来自base.html提供的方法 -->
<script src="{% static 'BonusApp/vendor/vendor/jquery/jquery.min.js'%}"></script>
<!-- 必须在bootstap之前引入 -->
<script src="{% static 'BonusApp/vendor/vendor/popper.js/umd/popper.min.js'%}"></script>
<script src="{% static 'BonusApp/vendor/vendor/bootstrap/js/bootstrap.min.js'%}"></script>
<script src="{% static 'BonusApp/vendor/javascript/theme.min.js'%}"></script>
<script src="{% static 'BonusApp/vendor/vendor/stacked-menu/js/stacked-menu.min.js'%}"></script>
<!-- Vue -->
<script src="{% static 'BaseProject/vendor/Vue/vue.js' %}"></script>
<script src="{% static 'BaseProject/vendor/Vue/vue-super.js' %}"></script>
<!-- datatables -->
<script src="{% static 'BaseProject/vendor/datatables-1.10.20/datatables.min.js' %}" type="text/javascript"></script>
<script src="{% static 'BaseProject/vendor/datatables-1.10.20/dataTables.colResize.js' %}" type="text/javascript"></script>
<script type="text/javascript" src="{% static 'BonusApp/tools/tool.js' %}"></script>
<script src="{% static 'Gallery/vendor/vue-grid-layout/vue-grid-layout.umd.js' %}"></script>
<script type="text/javascript" src="{% static 'BonusApp/js/loadmenu.js' %}"></script>
<script>
    $(function () {

    });
</script>

<script>
    var SpectacularsLayout = [
        { "x": 0, "y": 0, "w": 6, "h": 20, "i": "0", title: "Question" },
        { "x": 6, "y": 0, "w": 6, "h": 20, "i": "1", title: "TechnicalDoc" },
    ];
    var SpectacularsVm = new Vue({
        delimiters: ['[[', ']]'],
        //必須要與vue-grid-layout控件的Div ID一至
        el: '#app',
        data: {
            //上面定義的2個方框數組對象
            layout: SpectacularsLayout,
        }
    });

    $(function () {
        var groupColumn = 1;
        table1 = $("#task_datatable").DataTable({
            dom: `Z<'row'<'col-sm-12'tr>>`,// 配置自定义输入框
            serverSide: true, // 设置使用服务器处理数据的模式
            scrollX: false, // 是否开启水平滚动，以及指定滚动区域大小
            responsive: true, 
            ajax: {
                url: "/bonus/spectaculars/?identifying=question"
            },
            columns: [
                {
                    data: "createdate", //字段名稱
                    //定義要處理的日期函數
                    render: function ChangeDateFormat(value) { // 返回需要显示的内容
                        var reg = /^\s*$/;
                        //返回值為true表示不是空字符串
                        if (value != null && value != undefined && !reg.test(value)) {
                            return formatChatTime(parseDjangoTime(value));
                        } else
                            return '';
                    }
                },
                { name: "contact", data: "contact" },
                { name: "task", data: "task" },
                { name: "progress", data: "progress" },               
                {
                    data: "inc_id",
                    "mRender": function (id, type, row, setting) {
                        return `<a target="_blank" href="/bonus/get_Task_Details/?inc_id=`+ id +`"><i class="fa fa-chevron-right"></i></a>`;    
                        //return `<i class="fa fa-chevron-right"></i>`;
                    }
                },

            ],
            "drawCallback": function (settings) {
                let api = this.api();
                let rows = api.rows({ page: 'current' }).nodes();
                let last = null;
                let sum = 0;
                let name = null;
                api.column(groupColumn, { page: 'current' }).data().each(function (group, i) {
                    if (last !== group) {
                        $(rows).eq(i).before(
                            '<tr class="group"><td colspan="8">' + group + '</td></tr>'
                        );
                        last = group;
                    }
                });
            }
        })
    });

    $(function () {
        var groupColumn = 1;
        table2 = $("#simple_datatable2").DataTable({
            dom: `Z<'row'<'col-sm-12'tr>>`,
            serverSide: true, //启用服务端分页（这是使用Ajax服务端的必须配置）
            scrollX: false,
            responsive: true,
            ajax: {
                url: "/bonus/spectaculars/?identifying=technicalDoc"
            },
            columns: [
                {
                    data: "mb006", //字段名稱
                    //定義要處理的日期函數
                    render: function ChangeDateFormat(value) {
                        var reg = /^\s*$/;
                        //返回值為true表示不是空字符串
                        if (value != null && value != undefined && !reg.test(value)) {
                            return formatNumTime(value);
                        } else
                            return '';
                    }
                },
                { name: "mb005", data: "mb005" },
                { name: "mb004", data: "mb004" },
                { name: "mb020", data: "mb020" },
                { name: "mb010", data: "mb010" },
                {
                    data: "mb010",
                    "mRender": function (id, type, row, setting) { 
                        id = id.replace(/\s+/g, "");   
                        return `<a target="_blank" href="/bonus/spectaculars/technicalDoc_Details/?technicalDoc_id=`+ id +`"><i class="fa fa-chevron-right"></i></a>`;                    
                        //return `<i class="fa fa-chevron-right"></i>`;
                    }
                },

            ],
            "drawCallback": function (settings) {
                let api = this.api();
                let rows = api.rows({ page: 'current' }).nodes();
                let last = null;
                let sum = 0;
                let name = null;
                api.column(groupColumn, { page: 'current' }).data().each(function (group, i) {
                    if (last !== group) {
                        $(rows).eq(i).before(
                            '<tr class="group"><td colspan="8">' + group + '</td></tr>'
                        );
                        last = group;
                    }
                });
            }
        })
    });
    /*
    //查询问题详细信息
    $("#task_datatable").on('click', function () {
        var inc_id = $(this).find("td").eq(5).text();
        //alert(inc_id)
        
        window.location.href = '/bonus/get_Task_Details/?inc_id=229681' + inc_id;
        
    });

    //查询技术文档详细信息
    $("#simple_datatable2").on('click',  function () {
        var id = $(this).find("td").eq(5).text().replace(/\s+/g, "");
        //alert(id)
        window.location.href = '/bonus/spectaculars/technicalDoc_Details/?technicalDoc_id=' + id; 
    });
*/
    $("#prev_page").click(function () {
        history.go(-1);
    })

</script>

{% endblock %}
